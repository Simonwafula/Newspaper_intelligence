{
  "active": true,
  "iteration": 1,
  "maxIterations": 0,
  "completionPromise": "COMPLETE",
  "prompt": "You are a senior full-stack engineer + OCR/layout engineer. Build a NEW project from scratch in THIS empty repository: a “Newspaper PDF Intelligence” web app.\n\nQUALITY MANIFESTO (non-negotiable)\n“This codebase will outlive you. Every shortcut you take becomes someone else's burden. Every hack compounds into technical debt that slows the whole team down.\n\nYou are not just writing code. You are shaping the future of this\nproject. The patterns you establish will be copied. The corners\nyou cut will be cut again.\n\nFight entropy. Leave the codebase better than you found it.”\n\nRALPH / OPEN-CODE LOOP BEHAVIOR (use these ideas)\nYou are expected to work in tight autonomous iterations (Ralph Wiggum style):\n- Maintain durable project state in  and update it every iteration.\n- Each iteration must: pick ONE feature, implement it, run feedback loops (lint/typecheck/tests), update , and commit.\n- Always cap iterations when running in a loop (don’t run forever).\n- Use a completion marker: output <promise>COMPLETE</promise> ONLY when end-to-end MVP runs and all checks pass.\n- Support “mid-loop guidance”: read any human hints from  at the start of EACH iteration.\n\nNON-NEGOTIABLE WORKFLOW\n1) Create and maintain  at repo root.\n2)  must include:\n   - Project goal (1–2 paragraphs)\n   - Architecture diagram (ASCII ok)\n   - A numbered TODO backlog with nested sub-tasks. Every TODO has:\n     - Status: TODO | IN_PROGRESS | DONE | BLOCKED\n     - Definition of Done (DoD)\n     - Test/verification steps\n     - “Risk/unknowns” notes\n     - Files touched (paths)\n   - “Decisions & Assumptions” log (append-only)\n   - “Known Issues / Bugs” log (append-only)\n   - “Operational runbook” section: how to run dev, how to process a PDF, how to troubleshoot OCR\n3) Iteration loop:\n   - Pick highest-impact TODO not DONE (not necessarily first)\n   - Implement it fully (with minimal tests)\n   - Run feedback loops and record results in \n   - Commit with a meaningful message\n   - Continue until MVP is working end-to-end.\n4) If uncertain: make the best engineering assumption, document it in Decisions, proceed.\n\nPROJECT: NEWSPAPER PDF INTELLIGENCE (END STATE)\nBuild a web app where a user uploads a newspaper PDF edition and the system:\nA) Stores the edition (name, date, pages) and keeps the PDF + derived artifacts\nB) Extracts ALL text (selectable-text PDFs) and OCRs scanned PDFs\nC) Detects and lists:\n   - Stories/articles (headline/title, page number, extracted text)\n   - Adverts + classifieds (tenders, jobs, auctions, public notices, property, obituaries, etc.)\nD) Makes the whole edition searchable (keyword search + highlight + jump to page)\nE) Presents a usable UI:\n   - Editions Library (cards with cover thumbnail + counts)\n   - Edition Detail with tabs: Stories | Adverts/Classifieds | Search | Full PDF\n   - Item detail: extracted text + metadata + “open page” link\nF) Persists everything in a database\nG) Includes an export feature:\n   - Export extracted adverts/classifieds to CSV (minimum)\nH) Has strong guardrails:\n   - Upload validation (PDF only)\n   - Safe file serving (no path traversal)\n   - Size limits (configurable)\n   - Robust error handling (never crash the server on a bad PDF)\n\nIMPORTANT: Prioritize reliability over perfect ML accuracy. Start with heuristics; design so smarter extraction can be plugged in later.\n\nDATABASE STRATEGY (your requirement)\n- Dev default: SQLite (fast, zero-setup)\n- Prod target: PostgreSQL\n- Use SQLAlchemy + Alembic to support both with one schema.\n- Provide environment-based config:\n  - DATABASE_URL=sqlite:///./dev.db  (default)\n  - DATABASE_URL=postgresql+psycopg://user:pass@host:5432/dbname\n- Migrations must work for both (as much as possible). Document any SQLite limitations.\n\nNO DOCKER (your requirement)\n- Do not rely on Docker for dev.\n- Provide local setup instructions in README:\n  - \n  - \n  - \n- For Postgres (prod), document expected env vars and example systemd service or deployment notes (lightweight).\n\nMUST-HAVE “IMPORTANT FEATURES” (even if not discussed)\nImplement these baseline product features because they matter in real use:\n1) Edition metadata & deduping:\n   - Prevent duplicate uploads (hash the file and/or (name+date))\n2) Processing lifecycle:\n   - Status: UPLOADED → PROCESSING → READY → FAILED\n   - Persist logs/errors per edition; show “why failed” in UI\n3) Configurable pipeline:\n   - Allow toggling OCR on/off and setting OCR language(s) via env\n4) Observability:\n   - Structured logs\n   - Simple health endpoint (/healthz)\n5) Data retention:\n   - Admin setting for max stored editions and cleanup command (manual for MVP)\n6) Security basics:\n   - CORS configured\n   - Minimal rate-limiting on uploads (or document TODO)\n7) Developer Experience:\n   - One-command dev startup (make dev or )\n   - Pre-commit hooks optional; at minimum lint commands\n\nNICE-TO-HAVE (plan them; implement some if time permits)\n- User accounts (optional). If too much, implement “single-user local mode” but design DB for multi-user later.\n- Alert rules (keywords + classifier filters) and a “match count per new edition”\n- Entity extraction (people/org/places) and tag browsing\n- Cross-edition search (global search)\n- Better layout segmentation using bounding boxes\n- Basic analytics dashboard: counts of tenders/jobs per week\n- Bulk upload folder (drop multiple PDFs)\n\nTECH STACK (DEFAULT FOR A NEW PROJECT)\n- Backend: FastAPI (Python)\n- DB: SQLite (dev), PostgreSQL (prod)\n- Migrations: Alembic\n- Background processing: synchronous acceptable for MVP; store status in DB and allow reprocess.\n- Storage: local filesystem  (pdfs, page images, OCR text artifacts)\n- Frontend: React + Vite + TypeScript\n- PDF viewer: pdf.js in the client\n\nPDF / OCR TOOLING (IMPLEMENT BASELINE)\n- PDF parsing and page rendering: PyMuPDF (fitz)\n- OCR: Tesseract via pytesseract (must fail gracefully if not installed)\n- Extraction strategy:\n  - If text layer exists: extract text + blocks with coordinates (if possible)\n  - If extracted text too low: OCR the rendered page image\n  - Store page images only if needed for OCR or preview (avoid bloat)\n\nLAYOUT + ITEM EXTRACTION HEURISTICS (BASELINE)\n1) Determine if page is scanned:\n   - If extracted selectable text < MIN_CHARS (e.g., 200), treat as scanned → OCR\n2) Headline detection:\n   - If block font sizes available: choose top N larger-font lines as candidate headlines\n   - Else: heuristic: short lines, uppercase/title case, and likely near top of a block\n3) Item grouping:\n   - Group text blocks under a headline until the next headline\n4) Advert/classified classification (rule-based):\n   - Tender: TENDER, PREQUALIFICATION, REQUEST FOR PROPOSAL, RFP, RFQ\n   - Jobs: VACANCY, CAREER, JOB, APPLICATIONS INVITED\n   - Auction: AUCTION, REPOSSESSED, MOTOR VEHICLE AUCTION\n   - Notice: PUBLIC NOTICE, LOST, OBITUARY, DECEASED, NOTICE\n   - Property: TO LET, FOR SALE, PLOT, APARTMENT\n   - Else: STORY\n5) Best-effort structured extraction for classifieds:\n   - deadline dates\n   - email/URL/phone\n   - tender number/reference\n   - organization/entity line\n\nDATA MODEL (MINIMUM)\n- Edition:\n  id, newspaper_name, edition_date, file_hash, file_path, num_pages,\n  status, error_message, created_at, processed_at\n- Page:\n  id, edition_id, page_number, image_path(optional), extracted_text\n- Item:\n  id, edition_id, page_number,\n  item_type (STORY|AD|CLASSIFIED),\n  subtype (TENDER|JOB|AUCTION|NOTICE|PROPERTY|OTHER|null),\n  title, text, bbox_json(optional), extracted_entities_json(optional),\n  created_at\n- ExtractionRun (recommended):\n  id, edition_id, started_at, finished_at, log_path, version, success\n\nAPI REQUIREMENTS (MVP)\n- POST /api/editions (multipart: pdf + newspaper_name + edition_date)\n- GET /api/editions\n- GET /api/editions/{id}\n- POST /api/editions/{id}/reprocess\n- GET /api/editions/{id}/items?type=...&subtype=...\n- GET /api/editions/{id}/search?q=...\n- GET /api/editions/{id}/export/classifieds.csv\n- GET /api/healthz\n- Controlled file serving:\n  - GET /files/editions/{id}.pdf\n  - GET /files/pages/{page_id}.png\n\nSEARCH (MVP)\n- DB full-text search:\n  - SQLite: FTS5 (dev)\n  - Postgres: tsvector (prod)\n- Return ranked results:\n  - item_id, title, page_number, snippet with highlight markers\n\nFRONTEND REQUIREMENTS (MVP)\nPages:\n1) Editions Library\n   - Upload widget\n   - List cards: newspaper_name, date, status badge, counts\n2) Edition Detail\n   - Tabs: Stories | Adverts/Classifieds | Search | Full PDF\n3) Items list + filters\n4) Item Detail\n   - extracted text + “open page” link in viewer\n5) Search tab\n   - results with highlights\n6) Export button for classifieds CSV\n\nPROCESSING UX\n- After upload, show “Processing…”\n- Poll edition status until READY/FAILED\n- If FAILED: show error_message and (optionally) a safe log snippet\n\nFEEDBACK LOOPS (MANDATORY)\nBackend:\n- ruff (and optionally mypy)\n- pytest\nFrontend:\n- eslint\n- tsc --noEmit\n- vite build must succeed\n\nREPO STRUCTURE (SUGGESTED)\n/backend\n  /app\n    main.py\n    api/\n    db/\n    services/\n    models/\n    settings.py\n  /tests\n/frontend\n  src/\nagent-work.md\nREADME.md\nstorage/ (gitignored)\ndev.db (gitignored)\nMakefile (or dev.sh)\n\nDELIVERABLES (DEFINITION OF DONE)\nYou may output <promise>COMPLETE</promise> ONLY if:\n-  (or documented equivalent) runs backend+frontend\n- user can upload a PDF and see:\n  - edition appears in library\n  - processing completes (text extraction and/or OCR)\n  - stories + classifieds lists populate\n  - search works with highlights\n  - export classifieds.csv downloads\n- all feedback loops pass\n- README explains setup + usage + limitations (incl. OCR dependency)\n- agent-work.md reflects completed work + decisions + known issues\n\nNOW START\nStep 0: Scaffold the new project (backend + frontend + tooling) with no Docker.\nStep 1: Create agent-work.md with full plan and TODOs.\nStep 2: Implement iteratively with small commits, reading  each iteration.\nContinue recursively until MVP is working end-to-end, then output <promise>COMPLETE</promise>.",
  "startedAt": "2026-01-21T21:28:44.980Z",
  "model": ""
}